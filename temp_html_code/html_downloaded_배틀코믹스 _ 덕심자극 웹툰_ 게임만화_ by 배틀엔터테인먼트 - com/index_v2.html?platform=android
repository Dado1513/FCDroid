<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>Roulette</title>
    <script type="text/javascript" src="jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="jQueryRotate.js"></script>
    <script type="text/javascript" src="Base64.min.js"></script>
    <style>
        * {
            margin: 0;
            box-sizing: inherit;
        }

        body {
            width: 100%;
            margin: 56px 0 40px;
            background-color: #83e5da;
            box-sizing: border-box;
            text-align: center;
        }

        .container {
            overflow: hidden;
        }

        .title-img {
            width: 66.9%;
            margin-bottom: 11.1%;
        }

        .prize-notice {
            width: 73.3%;
            height: 30px;
            margin: 0 auto;
            padding: 0 7px;
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 15px;
            border: 2px solid #1ead9c;
            overflow: hidden;
            text-align: left;
        }

        .prize-notice__img {
            float: left;
        }

        .prize-notice__text {
            margin-left: 4px;
            color: white;
            overflow: hidden;
            font-size: .875em;
            line-height: 26px;
            text-overflow: ellipsis;
            white-space: nowrap;
            word-wrap: normal;
        }

        .roulette {
            position: relative;
            margin: 7.5% 5.55% 10%;
        }

        .roulette::after {
            content: '';
            clear: both;
            display: table;
        }

        .roulette::before {
            content: '';
            position: absolute;
            z-index: -1;
            width: 130vw;
            height: 100%;
            background-color: #20d4be;
            transform: rotate(45deg);
            transform-origin: left;
        }

        .roulette__pin {
            position: absolute;
            width: 7.2%;
            margin: 0 auto;
            top: -3.6%;
            right: 0;
            left: 0;
            z-index: 1;
        }

        .roulette__img {
            float: left;
            width: 100%;
        }

        .roulette__start {
            position: absolute;
            top: 37.25%;
            right: 0;
            left: 0;
            width: 25%;
            height: 25%;
            margin: 0 auto;
            background-image: url('roulette_start.svg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .roulette__coupon {
            position: absolute;
            right: 0;
            bottom: 20%;
            left: 0;
            color: white;
            font-size: .75em;
        }

        .table {
            width: 83.33%;
            margin: 0 auto 4.44%;
            background-color: #fff;
            font-size: .625em;
        }

        .table__header {
            height: 22px;
            background-color: #eff1f6;
            color: #3f4149;
            font-weight: bold;
            line-height: 2.2;
        }

        .table__body {
            padding: 6px 0;
            color: #667782;
            line-height: 1.2;
        }

        .table__body p + p {
            margin-top: 6px;
        }

        .table__body::after {
            content: '';
            clear: both;
            display: table;
        }

        .table__row {
            color: #667782;
            line-height: 1.2;
        }

        .table__row + .table__row {
            border-top: 1px solid #eff1f6;
        }

        .table__row::after {
            content: '';
            clear: both;
            display: table;
        }

        .table__row__header {
            float: left;
            width: 36%;
            padding: 6px 0;
        }

        .table__row__body {
            float: left;
            width: 64%;
            padding: 6px 0;
            border-left: 1px solid #eff1f6;
        }

        .table__row__body p:only-child {
            line-height: 2.4;
        }
    </style>
</head>
<body>
<div class="container">
    </h1>
    <img src="roulette_title.svg" alt="100% 당첨되는 행운의 뽑기" class="title-img">

    <div class="prize-notice">
        <img src="roulette_noti.svg" class="prize-notice__img">
        <p class="prize-notice__text"></p>
    </div>

    <div class="roulette">
        <img src="roulette_pin.svg" class="roulette__pin">
        <img src="roulette_img_v2.png" id="roulette" class="roulette__img">
        <div id="roulette_start" class="roulette__start">
      <span class="roulette__coupon">
        뽑기권: <span id="ticket_count">0</span>
      </span>
        </div>
    </div>

    <div class="table">
        <div class="table__header">
            참여방법
        </div>
        <div class="table__body">
            <p>무료충전소 참여로 무료포인트 충전</p>
            <img src="roulette_clamp.svg">
            <p>행운의 뽑기권 획득</p>
            <img src="roulette_clamp.svg">
            <p>뽑기 참여하고 100% 추가 선물 당첨</p>
        </div>
    </div>

    <div class="table">
        <div class="table__header">
            뽑기권 지급 기준
        </div>
        <div class="table__row">
            <div class="table__row__header">
                <p>
                    200포인트 미만 <br> 무료충전
                </p>
            </div>
            <div class="table__row__body">
                <p>
                    뽑기권 1장
                </p>
            </div>
        </div>
        <div class="table__row">
            <div class="table__row__header">
                <p>
                    200포인트 이상 <br> 무료충전
                </p>
            </div>
            <div class="table__row__body">
                <p>
                    100포인트 당 뽑기권 1장
                </p>
                <p>
                    (예-300포인트 충전 = 뽑기권 3장)
                </p>
            </div>
        </div>
    </div>

    <div class="table">
        <div class="table__header">
            당첨 상품 수령
        </div>
        <div class="table__body">
            <p>당첨된 포인트 및 코인은 <b>선물함</b>에서 확인 가능합니다</p>
            <p>선물함에서 <b>14일</b> 이내에 ‘<b>선물받기</b>‘를 실행해야<br> 지급이 완료됩니다</p>
        </div>
    </div>

    <div class="table">
        <div class="table__header">
            유의사항
        </div>
        <div class="table__body">
            <p>무료충전소 참여 후 뽑기권 지급까지<br> 시간이 소요될 수 있습니다</p>
            <p>이벤트 부정 참여 시, 당첨 취소는 물론 서비스 이용에<br> 제한이 생길 수 있습니다</p>
            <p>상시 제공되는 기능이지만, 당사 사정에 의해<br> 사전 고지없이 변경 또는 종료될 수 있습니다</p>
        </div>
    </div>
</div>
<script type="text/javascript">
    $.urlParam = function (name) {
        var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
        if (results == null) {
            return null;
        } else {
            return results[1] || 0;
        }
    }

    var platform = $.urlParam('platform')
    var lock = false

    function callback() {
        setTimeout(function () {
            lock = false
            try {
                if (platform == 'android') {
                    Android.endAnimation()
                } else if (platform == 'ios') {
                    window.location = 'battlecomicswebview:endAnimation'
                }
            } catch (e) {
            }
        }, 1000)
    }

    function rotation(angle) {
        if (lock) return;
        $('#roulette').rotate({
            angle: 0,
            animateTo: (360 * 5) + Number(angle),
            center: ['50%', '50%'],
            easing: function (x, t, b, c, d) {
                return (t == d) ? b + c : c * (-Math.pow(2, -10 * t / d) + 1) + b;
            },
            callback: callback,
            duration: 6000
        });
    }

    function init(angle) {
        angle = Number(angle)
        $('#roulette').rotate({
            angle: -angle,
            animateTo: angle,
            center: ['50%', '50%'],
            easing: $.easing.easeInOutElastic,
            callback: function () {
                init(-angle)
            },
            duration: 1000
        });
    }

    function setTicketCount(count) {
        $('#ticket_count').text(count)
    }

    var rankInterval;
    var ranks = []
    function setRanks(rouletteTickets) {
        $('.prize-notice__text').empty()
        var rouletteTickets = JSON.parse(Base64.decode(rouletteTickets))
        if (rouletteTickets.length == 0) return
        if (rankInterval) clearInterval(rankInterval)
        rouletteTickets.forEach(function (ticket) {
            var reward;
            if (ticket.roulette_product.reward_type == 'coin') {
                reward = ticket.roulette_product.reward_amount + '코인 당첨'
            } else if (ticket.roulette_product.reward_type == 'cash') {
                reward = ticket.roulette_product.reward_amount + '포인트 당첨'
            }
            ranks.push('<b>' + reward + '</b> - ' + ticket.user.name)
        });
        $('.prize-notice__text').append(ranks[0])
        rankInterval = setInterval(function () {
            ranks.push(ranks.shift())
            $('.prize-notice__text').fadeOut(300, function () {
                $(this).empty().append(ranks[0])
                $(this).fadeIn(300)
            })
        }, 4000);
    }

    $('#roulette_start').click(function () {
        if (platform == 'android') {
            Android.clickStart()
        } else if (platform == 'ios') {
            window.location = 'battlecomicswebview:clickStart'
        }
    });

    $(document).ready(function () {
        init(5)
    });
</script>
</body>
</html>